define("_generated/Less/MsPortalImpl/Widgets/Widgets.Console.css",["require","exports","o","module"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});window.fx.injectCss(r,".fxs-console{z-index:200;background-color:#222;border-top:1px solid #aaa;width:100%;-webkit-flex:0 0 auto;flex:0 0 auto;max-height:calc(100% - 40px);min-height:40px;position:relative}.fxs-console-header{cursor:ns-resize;height:5px;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;background-color:#dbdbdb;padding:1px 10px 0 20px;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fxs-console-header:hover{background-color:#ccc}.fxs-console-header:active{background-color:#bfbfbf}.fxs-console-resizecurtain{position:absolute;top:5px;bottom:0;left:0;right:0;pointer-events:none}.fxs-console-iframe{width:100%;height:calc(100% - 5px)}.fxs-console-handle{-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;fill:#515960;margin:0 auto;height:20px;display:block}.fxs-console-handle svg{height:15px;width:15px}")}));
define("MsPortalImpl/Widgets/Widgets.Console",["require","exports","f","i","ko","$","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.EventTypes","Fx/Ajax","_generated/Less/MsPortalImpl/Widgets/Widgets.Console.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";var a;return (function(n){var g=i.Base,a=g.Diagnostics.Telemetry,v=h.Action,y=h.Source.Shell,t=window,p=f(document),ot=t.fx.environment,nt=o.Console,b=-1,w=300,st=40,ht=0,ct=w,tt=20,it="fxs-console",rt="fxs-console-header",ut="fxs-console-iframe",k="fxs-console-resizecurtain",ft="consoleFrameId",d="portalConsole",lt={"":"console.arm",azurebatch:"console.azurebatch",datalake:"console.datalake",graph:"console.graph",keyvault:"console.keyvault","microsoft.graph":"console.microsoft.graph",office365:"console.office365",powerbi:"console.powerbi"},at=(function(n){function t(t){var i=n.call(this)||this;return i.isVisible=u.observable(!1),i.src=t.src,i.region=t.region,i.getAuthToken=t.getAuthToken,i.features=t.features,i}return __extends(t,n),t})(e.ViewModel),et;n.ViewModel=at;et=(function(n){function e(e,o){var s=n.call(this,e,o)||this,v,h;s._isOpen=!1;s._isMax=!1;s._lastHeight=w;s._previousHeight=b;s._previousHeightTolerance=st;var y=o.src,l=s._uriBuilder=new g.UriBuilder(y),d=l.query,a={region:o.region,trustedAuthority:r.trustedParentOrigin,l:ot.effectiveLocale};i.forEachKey(o.features.value,(function(n,t){n.toLowerCase().startsWith("azureconsole")&&(a["feature."+n]=t)}));d.setParameters(a);s._trustedOrigin=l.getSchemeAndAuthority();e.css("position","relative");e.addClass(it);v='<div class="'+rt+'" role="separator" tabindex="0" aria-valuenow="'+w+'" aria-controls="'+ft+'"><div class="fxs-console-handle" data-bind="image: MsPortalFx.Base.Images.Ellipsis({palette: 99, isLogo: true})"><\/div><\/div>'+('<div class="'+k+'"><\/div>');e.html(v);u.applyBindings({},s.element[0]);h=s._windowSplitterElement=e.findByClassName(rt);s._minConsoleHeight=Number(e.css("min-height"))||ht;s._maxConsoleHeight=Number(e.css("max-height"))||ct;f(h).attr({"aria-label":nt.ariaSplitter,"aria-valuemin":s._minConsoleHeight,"aria-valuemax":s._maxConsoleHeight});s._addFrame(e);f(h).on(c.default.mousedown,(function(n){var u,r,i,o,h;if(!s._isMax){u=n.clientY;r=e.height();s._collapseConsolePane(e);e.height(r);i=!0;f.querySelectorAll("."+k).css("pointerEvents","all");p.on(c.default.mousemove,h=function(n){n.preventDefault();i&&(i=!1,t.requestAnimationFrame((function(){e.height(r+u-n.clientY);i=!0})))}).on(c.default.mouseup,o=function(){s._lastHeight=e.height();s._windowSplitterElement.attr("aria-valuenow",s._lastHeight);f.querySelectorAll("."+k).css("pointerEvents","none");p.off(c.default.mousemove,h);p.off(c.default.mouseup,o)})}}));f(h).on(c.default.keydown,(function(n){if(!s._isMax){var t=!1,i=e.height();switch(n.keyCode){case 38:t=!0;e.height(i+tt);break;case 40:t=!0;e.height(i-tt);break;case 13:t=!0;s._minConsoleHeight<i-s._previousHeightTolerance?(s._previousHeight=i,s._collapseConsolePane(e)):b===s._previousHeight?e.height(w):(e.height(s._previousHeight),s._previousHeight=b);break;case 36:t=!0;s._previousHeight=i;s._collapseConsolePane(e);break;case 35:t=!0;s._expandConsolePane(e)}t&&(n.stopPropagation(),s._lastHeight=e.height(),s._windowSplitterElement.attr("aria-valuenow",s._lastHeight))}}));return s}return __extends(e,n),e.prototype._collapseConsolePane=function(n){n.height(this._minConsoleHeight);this._previousHeightTolerance=n.height()-this._minConsoleHeight},e.prototype._expandConsolePane=function(n){n.height(this._maxConsoleHeight)},e.prototype.toggle=function(){this._isOpen?this._hide():this._show()},e.prototype.dispose=function(){this._cleanElement(it);this.element.empty();t.removeEventListener("message",this._postMessageHandler,!1);p.off(c.default.keydown,this._escapeHandler);f(t).off(c.default.resize,this._resizeWindowHandler);n.prototype.dispose.call(this)},e.prototype._addFrame=function(n){var i=r.createElement("iframe",{"class":ut,id:ft,role:"document",sandbox:"allow-scripts allow-same-origin allow-popups allow-forms",frameborder:"0"}),t;this._windowSplitterElement.attr("aria-valuenow",w);n.height(w).append(i);t=this._iframeElement=n.findByClassName(ut);t.attr({"aria-label":nt.console,src:this._uriBuilder.toString()});a.trace({source:y,action:v.ConsoleOpened})},e.prototype._show=function(){var n=this;this._isOpen=!0;this.options.isVisible(this._isOpen);s.unhide(this.element);this._iframeElement||this._addFrame(this.element);t.addEventListener("message",this._postMessageHandler=function(t){var i,r,f,e,u;if(t.origin===n._trustedOrigin&&(i=t.data||{},r=t.source,r&&i.signature===d))switch(i.type){case"getToken":f=i.audience||"";e=lt[i.audience];n.options.getAuthToken!==undefined&&n.options.getAuthToken({resourceName:e}).then((function(n){r.postMessage({signature:d,type:"postToken",audience:f,message:n},t.origin)}));break;case"getArmEndpoint":u=function(){n._iframeElement&&r.postMessage({signature:d,type:"postArmEndpoint",message:n._armEndpoint},t.origin)};n._armEndpoint?u():(n._armEndpoint=l.getEndpoints().arm,u());break;case"close":n._iframeElement.remove();n._iframeElement=null;n._hide();a.trace({source:y,action:v.ConsoleClosed});break;case"minimize":n._hide();a.trace({source:y,action:v.ConsoleMinimized});break;case"maximize":n._maximize();a.trace({source:y,action:v.ConsoleMaximized});break;case"restore":n._restore();a.trace({source:y,action:v.ConsoleRestored});break;case"openFileShare":n._openFileShare(i.resourceId,i.fileShare);a.trace({source:y,action:v.OpenFileShare})}},!1);p.on(c.default.keydown,this._escapeHandler=function(t){t.keyCode===27&&n._hide()});f(t).on(c.default.resize,this._resizeWindowHandler=function(){n._windowSplitterElement.attr("aria-valuemax",n.element.css("max-height"))})},e.prototype._hide=function(){this._isOpen=!1;this.options.isVisible(this._isOpen);this._isMax=!1;s.hide(this.element);t.removeEventListener("message",this._postMessageHandler,!1);p.off(c.default.keydown,this._escapeHandler);f(t).off(c.default.resize,this._resizeWindowHandler)},e.prototype._maximize=function(){this._isMax=!0;this.element.height("100%");this._windowSplitterElement.attr("aria-valuenow",this.element.height())},e.prototype._restore=function(){this._isMax=!1;this.element.height(this._lastHeight);this._windowSplitterElement.attr("aria-valuenow",this._lastHeight)},e.prototype._openFileShare=function(n,i){var r="#blade/Microsoft_Azure_Storage/FilesGridBlade/storageAccountId/"+encodeURIComponent(n)+"/path/"+encodeURIComponent(i);t.open(r,"_self")},e})(e.Widget);n.Widget=et})(a||(a={})),a}))